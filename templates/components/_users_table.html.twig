<div class="table-responsive border border-black border-opacity-25 ">
    {# {{ dump(users) }} #}
    {% if users|length > 0 %}
        <table class="table table-striped table-hover">
            <thead class="table-light">
            <tr>
                <th scope="col" class="p-3">Username</th>
                <th scope="col" class="p-3">Email</th>
                <th scope="col" class="p-3">Role</th>
                <th scope="col" class="p-3">Status</th>
                <th scope="col" class="p-3">Terms</th>
                <th scope="col" class="p-3">Created</th>


                {#                <th scope="col" class="p-3"> #}
                {#                    <a #}
                {#                        href="{{ path('user.blogsTable', { order: order == 'ASC' ? 'DESC' : 'ASC' }) }}"> #}
                {#                        Created #}
                {#                        {% if order == 'ASC' %} #}
                {#                            <img src="{{ asset('icons/Sort From Bottom To Top.svg') }}" alt="sort icon"> #}
                {#                        {% else %} #}
                {#                            <img src="{{ asset('icons/Sort From Top To Bottom.svg') }}" alt="sort icon"> #}
                {#                        {% endif %} #}
                {#                    </a> #}
                {#                </th> #}

                {#                <th scope="col" class="py-3">Status</th> #}

                <th scope="col" class="pe-3 py-3">Update</th>
            </tr>
            </thead>
            <tbody>
            {% for key,user in users %}
                <tr>
                    {#   Username  #}
                    <td class="p-3 fs-7">
                        <div class="d-flex align-items-center gap-1">
                            <span class="position-relative">
                                {{ user.username }}

                                {% if is_granted('ROLE_ADMIN') and user.id == app.user.id %}
                                    <span class="new_category_indicator"
                                          data-bs-toggle="tooltip"
                                          data-bs-placement="top"
                                          data-bs-title="You"></span>
                                {% endif %}
                            </span>
                        </div>
                    </td>

                    {#   Email   #}
                    <td class="p-3 fs-7">
                        <a href="mailto:{{ user.email }}"
                           class="link-no-underline-black d-inline-block align-items-center ">
                            <img class="me-2" src="{{ asset('icons/Link Square.svg') }}" alt="pen icon">
                            {{ user.email|u.truncate(16, '...') }}
                        </a>
                    </td>

                    {#   Role  #}
                    <td class="p-3 fs-7">
                        <div class="d-flex align-items-center gap-1">
                            {#  <span>{{ user.roles|join(', ') }}</span> #}
                            {% if 'ROLE_ADMIN' in user.roles %}
                                Admin
                            {% elseif 'ROLE_BLOGGER' in user.roles %}
                                Blogger
                            {% else %}
                                User
                            {% endif %}
                        </div>
                    </td>

                    {#   Status  #}
                    <td class="p-3 fs-7">
                        <div class="d-flex align-items-center gap-1">
                            <span>
                                <a
                                    href="#"
                                    class="open-status-modal"
                                    data-user-id="{{ user.id }}"
                                    data-username="{{ user.username }}"
                                >
                                    {% if (user.active) %}
                                        <span class="indicator published"
                                              data-bs-toggle="tooltip"
                                              data-bs-placement="top"
                                              data-bs-title="Active"
                                        >
                                        </span>
                                    {% else %}
                                        <span class="indicator danger"
                                              data-bs-toggle="tooltip"
                                              data-bs-placement="top"
                                              data-bs-title="Restricted"
                                        >
                                        </span>
                                    {% endif %}
                                </a>
                            </span>
                        </div>
                    </td>

                    {#   Terms  #}
                    <td class="p-3 fs-7">
                        <div class="d-flex align-items-center gap-1">
                            <span>
                                {% if (user.terms) %}
                                    agreed
                                {% else %}
                                    not agreed
                                {% endif %}
                            </span>
                        </div>
                    </td>

                    {#   Created_at   #}
                    <td class="p-3 fs-7">{{ user.createdAt|date('Y-m-d') }}</td>

                    {#   Action buttons   #}
                    <td class="p-3">
                        {% if 'ROLE_ADMIN' not in user.roles %}
                            {#   delete   #}
                            <a href="#" class="me-3 open-delete-modal"
                               data-user-id="{{ user.id }}"
                               data-username="{{ user.username }}"
                            >
                                <img
                                    data-bs-toggle="tooltip"
                                    data-bs-placement="top"
                                    data-bs-title="Delete"
                                    src="{{ asset('icons/Trash Bin Trash.svg') }}"
                                    alt="bin icon">
                            </a>
                            {#   edit   #}
                            <a href="{{ path('dashboard.userEdit', {id: user.id} ) }}"
                               data-bs-toggle="tooltip"
                               data-bs-placement="top"
                               data-bs-title="Edit"
                            >
                                <img src="{{ asset('icons/Pen New Square.svg') }}" alt="pen icon">
                            </a>
                        {% else %}
                            <p class="text-secondary d-inline-block position-relative fs-7">
                                Admin
                                {% if user.id == app.user.id %}
                                    <span class="new_category_indicator"
                                          data-bs-toggle="tooltip"
                                          data-bs-placement="top"
                                          data-bs-title="You"></span>

                                {% endif %}
                            </p>
                        {% endif %}
                    </td>
                </tr>

                {#                {% include "components/_modalConfirm.html.twig" with { #}
                {#                    modal_id: "deleteModal-" ~ user.id, #}
                {#                    title: "Confirm Deletion", #}
                {#                    body: "Are you sure you want to delete the user '<strong>"~ user.username ~"</strong>'?", #}
                {#                    confirm_path: path('userDelete', {id: user.id}), #}
                {#                    confirm_text: "Delete" #}
                {#                } %} #}

                {#                {% include "components/_modalConfirm.html.twig" with { #}
                {#                    modal_id: "updateModal-" ~ user.id, #}
                {#                    title: "Update Status", #}
                {#                    body: "Are you sure you want to update the user '<strong>"~ user.username~ "</strong>' status?", #}
                {#                    confirm_path: path('userStatus', {id: user.id}), #}
                {#                    confirm_text: "Confirm" #}
                {#                } %} #}

            {% endfor %}
            </tbody>
        </table>
    {% else %}
        {{ include('components/_emptyPage.html.twig' , {message : "No Users yet", linkText: "New User", linkPath: "dashboard.userCreate"}) }}
    {% endif %}



    {% include "components/_modalConfirm.html.twig" with {
        modal_id: "globalDeleteModal",
        title: "Confirm Deletion",
        body: "Are you sure you want to delete the user '<strong id=\"deleteUsername\"></strong>'?",
        confirm_path: "",
        confirm_text: "Delete"
    } %}

    {% include "components/_modalConfirm.html.twig" with {
        modal_id: "globalStatusModal",
        title: "Update Status",
        body: "Are you sure you want to update the user '<strong id=\"statusUsername\"></strong>' status?",
        confirm_path: "",
        confirm_text: "Confirm"
    } %}
</div>


<script>
    document.addEventListener('click', function (e) {

        const delBtn = e.target.closest('.open-delete-modal');
        if (delBtn) {
            e.preventDefault();
            const userId = delBtn.dataset.userId;
            const username = delBtn.dataset.username;
            const modalEl = document.getElementById('globalDeleteModal');
            const form = modalEl.querySelector('#confirmActionForm');
            const usernameEl = modalEl.querySelector('#deleteUsername');

            if (form) {
                form.action = `/users/delete/${userId}`;
            }
            if (usernameEl) {
                usernameEl.textContent = username;
            }

            // Show the modal using Bootstrap
            if (window.bootstrap && window.bootstrap.Modal) {
                const modal = window.bootstrap.Modal.getOrCreateInstance(modalEl);
                modal.show();
            }
        }

        const statusBtn = e.target.closest('.open-status-modal');
        if (statusBtn) {
            e.preventDefault();
            const userId = statusBtn.dataset.userId;
            const username = statusBtn.dataset.username;
            const modalEl = document.getElementById('globalStatusModal');
            const form = modalEl.querySelector('#confirmActionForm');
            const usernameEl = modalEl.querySelector('#statusUsername');

            if (form) {
                form.action = `/user-status/${userId}`;
            }
            if (usernameEl) {
                usernameEl.textContent = username;
            }

            // Show the modal using Bootstrap
            if (window.bootstrap && window.bootstrap.Modal) {
                const modal = window.bootstrap.Modal.getOrCreateInstance(modalEl);
                modal.show();
            }
        }
    });

</script>
